<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.springframework.org/schema/beans"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <!--************************************************************************
    * Data Sets
    *************************************************************************-->

    <bean id="dataset.kmeans-test.static.points" class="org.peelframework.core.beans.data.CopiedDataSet">
        <constructor-arg name="src" value="${app.path.datasets}/data_test.csv"/>
        <constructor-arg name="dst" value="${system.hadoop-2.path.input}/data_test.csv"/>
        <constructor-arg name="fs" ref="hdfs-2.7.1"/>
    </bean>

    <!--************************************************************************
    * Experiments
    *************************************************************************-->

    <!-- K-Means output -->
    <bean id="kmeans-test.output" class="org.peelframework.core.beans.data.ExperimentOutput">
        <constructor-arg name="path" value="${system.hadoop-2.path.output}/data_test"/>
        <constructor-arg name="fs" ref="hdfs-2.7.1"/>
    </bean>

    <bean id="experiment.flink.kmeans.plain.iter5" parent="experiment.flink-1.0.3" abstract="true">
        <constructor-arg name="command">
            <value><![CDATA[
              -v -c de.tu_berlin.dima.bdapro.benchmarks.kmeans.flink.KMeans             \
              ${app.path.apps}/peel-flink-kmeans-flink-jobs-1.0-SNAPSHOT.jar            \
              --points ${system.hadoop-2.path.input}/data_test.csv                      \
              --output ${system.hadoop-2.path.output}/data_test/result-plain-5.csv                \
              --clustersize 4                                                           \
              --iteration 5                                                             \
              --differiteration
            ]]></value>
        </constructor-arg>
        <constructor-arg name="outputs">
            <set value-type="org.peelframework.core.beans.data.ExperimentOutput">
                <ref bean="kmeans-test.output"/>
            </set>
        </constructor-arg>
    </bean>

    <bean id="experiment.flink.kmeans.plain.iter10" parent="experiment.flink-1.0.3" abstract="true">
        <constructor-arg name="command">
            <value><![CDATA[
              -v -c de.tu_berlin.dima.bdapro.benchmarks.kmeans.flink.KMeans             \
              ${app.path.apps}/peel-flink-kmeans-flink-jobs-1.0-SNAPSHOT.jar            \
              --points ${system.hadoop-2.path.input}/data_test.csv                      \
              --output ${system.hadoop-2.path.output}/data_test/result-plain-10.csv               \
              --clustersize 4                                                           \
              --iteration 10                                                            \
              --differiteration
            ]]></value>
        </constructor-arg>
        <constructor-arg name="outputs">
            <set value-type="org.peelframework.core.beans.data.ExperimentOutput">
                <ref bean="kmeans-test.output"/>
            </set>
        </constructor-arg>
    </bean>

    <bean id="experiment.flink.kmeans.plusplus.iter5" parent="experiment.flink-1.0.3" abstract="true">
        <constructor-arg name="command">
            <value><![CDATA[
              -v -c de.tu_berlin.dima.bdapro.benchmarks.kmeans.flink.KMeans             \
              ${app.path.apps}/peel-flink-kmeans-flink-jobs-1.0-SNAPSHOT.jar            \
              --points ${system.hadoop-2.path.input}/data_test.csv                      \
              --output ${system.hadoop-2.path.output}/data_test/result-plusplus-5.csv             \
              --clustersize 4                                                           \
              --iteration 5                                                             \
              --differiteration                                                         \
              --plusplus
            ]]></value>
        </constructor-arg>
        <constructor-arg name="outputs">
            <set value-type="org.peelframework.core.beans.data.ExperimentOutput">
                <ref bean="kmeans-test.output"/>
            </set>
        </constructor-arg>
    </bean>

    <bean id="experiment.flink.kmeans.plusplus.iter10" parent="experiment.flink-1.0.3" abstract="true">
        <constructor-arg name="command">
            <value><![CDATA[
              -v -c de.tu_berlin.dima.bdapro.benchmarks.kmeans.flink.KMeans             \
              ${app.path.apps}/peel-flink-kmeans-flink-jobs-1.0-SNAPSHOT.jar            \
              --points ${system.hadoop-2.path.input}/data_test.csv                      \
              --output ${system.hadoop-2.path.output}/data_test/result-plusplus-10.csv            \
              --clustersize 4                                                           \
              --iteration 10                                                            \
              --differiteration                                                         \
              --plusplus
            ]]></value>
        </constructor-arg>
        <constructor-arg name="outputs">
            <set value-type="org.peelframework.core.beans.data.ExperimentOutput">
                <ref bean="kmeans-test.output"/>
            </set>
        </constructor-arg>
    </bean>

    <bean id="experiment.flink.kmeans.minibatch.samplesize10" parent="experiment.flink-1.0.3" abstract="true">
        <constructor-arg name="command">
            <value><![CDATA[
              -v -c de.tu_berlin.dima.bdapro.benchmarks.kmeans.flink.KMeans             \
              ${app.path.apps}/peel-flink-kmeans-flink-jobs-1.0-SNAPSHOT.jar            \
              --points ${system.hadoop-2.path.input}/data_test.csv                      \
              --output ${system.hadoop-2.path.output}/data_test/result-minibatch-10.csv           \
              --clustersize 4                                                           \
              --iteration 10                                                            \
              --differiteration                                                         \
              --minibatch                                                               \
              --samplesize 10
            ]]></value>
        </constructor-arg>
        <constructor-arg name="outputs">
            <set value-type="org.peelframework.core.beans.data.ExperimentOutput">
                <ref bean="kmeans-test.output"/>
            </set>
        </constructor-arg>
    </bean>

    <bean id="experiment.flink.kmeans.minibatch.samplesize20" parent="experiment.flink-1.0.3" abstract="true">
        <constructor-arg name="command">
            <value><![CDATA[
              -v -c de.tu_berlin.dima.bdapro.benchmarks.kmeans.flink.KMeans             \
              ${app.path.apps}/peel-flink-kmeans-flink-jobs-1.0-SNAPSHOT.jar            \
              --points ${system.hadoop-2.path.input}/data_test.csv                      \
              --output ${system.hadoop-2.path.output}/data_test/result-minibatch-20.csv           \
              --clustersize 4                                                           \
              --iteration 10                                                            \
              --differiteration                                                         \
              --minibatch                                                               \
              --samplesize 20
            ]]></value>
        </constructor-arg>
        <constructor-arg name="outputs">
            <set value-type="org.peelframework.core.beans.data.ExperimentOutput">
                <ref bean="kmeans-test.output"/>
            </set>
        </constructor-arg>
    </bean>

    <bean id="experiment.flink.kmeans.bisecting.itersample3" parent="experiment.flink-1.0.3" abstract="true">
        <constructor-arg name="command">
            <value><![CDATA[
              -v -c de.tu_berlin.dima.bdapro.benchmarks.kmeans.flink.KMeans             \
              ${app.path.apps}/peel-flink-kmeans-flink-jobs-1.0-SNAPSHOT.jar            \
              --points ${system.hadoop-2.path.input}/data_test.csv                      \
              --output ${system.hadoop-2.path.output}/data_test/result-bisect-10-3.csv            \
              --clustersize 4                                                           \
              --iteration 10                                                            \
              --differiteration                                                         \
              --bisect                                                                  \
              --iterationsamples 3
            ]]></value>
        </constructor-arg>
        <constructor-arg name="outputs">
            <set value-type="org.peelframework.core.beans.data.ExperimentOutput">
                <ref bean="kmeans-test.output"/>
            </set>
        </constructor-arg>
    </bean>

    <bean id="experiment.flink.kmeans.bisecting.itersample5" parent="experiment.flink-1.0.3" abstract="true">
        <constructor-arg name="command">
            <value><![CDATA[
              -v -c de.tu_berlin.dima.bdapro.benchmarks.kmeans.flink.KMeans             \
              ${app.path.apps}/peel-flink-kmeans-flink-jobs-1.0-SNAPSHOT.jar            \
              --points ${system.hadoop-2.path.input}/data_test.csv                      \
              --output ${system.hadoop-2.path.output}/data_test/result-bisect-10-5.csv            \
              --clustersize 4                                                           \
              --iteration 10                                                            \
              --differiteration                                                         \
              --bisect                                                                  \
              --iterationsamples 5
            ]]></value>
        </constructor-arg>
        <constructor-arg name="outputs">
            <set value-type="org.peelframework.core.beans.data.ExperimentOutput">
                <ref bean="kmeans-test.output"/>
            </set>
        </constructor-arg>
    </bean>

    <bean id="experiment.flink.kmeans.bisecting.itersample11" parent="experiment.flink-1.0.3" abstract="true">
        <constructor-arg name="command">
            <value><![CDATA[
              -v -c de.tu_berlin.dima.bdapro.benchmarks.kmeans.flink.KMeans             \
              ${app.path.apps}/peel-flink-kmeans-flink-jobs-1.0-SNAPSHOT.jar            \
              --points ${system.hadoop-2.path.input}/data_test.csv                      \
              --output ${system.hadoop-2.path.output}/data_test/result-bisect-10-11.csv           \
              --clustersize 4                                                           \
              --iteration 10                                                            \
              --differiteration                                                         \
              --bisect                                                                  \
              --iterationsamples 11
            ]]></value>
        </constructor-arg>
        <constructor-arg name="outputs">
            <set value-type="org.peelframework.core.beans.data.ExperimentOutput">
                <ref bean="kmeans-test.output"/>
            </set>
        </constructor-arg>
    </bean>

    <!--************************************************************************
    * Suites
    *************************************************************************-->

    <!-- suite for local development and testing -->
    <bean id="kmeans-test.plain-5" class="org.peelframework.core.beans.experiment.ExperimentSuite">
        <constructor-arg name="experiments">
            <list value-type="org.peelframework.core.beans.experiment.Experiment">
                <bean parent="experiment.flink.kmeans.plain.iter5">
                    <constructor-arg name="name" value="kmeans.flink"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-test.static.points" />
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
            </list>
        </constructor-arg>
    </bean>

    <bean id="kmeans-test.plain-10" class="org.peelframework.core.beans.experiment.ExperimentSuite">
        <constructor-arg name="experiments">
            <list value-type="org.peelframework.core.beans.experiment.Experiment">
                <bean parent="experiment.flink.kmeans.plain.iter10">
                    <constructor-arg name="name" value="kmeans.flink"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-test.static.points" />
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
            </list>
        </constructor-arg>
    </bean>

    <bean id="kmeans-test.plusplus-5" class="org.peelframework.core.beans.experiment.ExperimentSuite">
        <constructor-arg name="experiments">
            <list value-type="org.peelframework.core.beans.experiment.Experiment">
                <bean parent="experiment.flink.kmeans.plusplus.iter5">
                    <constructor-arg name="name" value="kmeans.flink"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-test.static.points" />
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
            </list>
        </constructor-arg>
    </bean>

    <bean id="kmeans-test.plusplus-10" class="org.peelframework.core.beans.experiment.ExperimentSuite">
        <constructor-arg name="experiments">
            <list value-type="org.peelframework.core.beans.experiment.Experiment">
                <bean parent="experiment.flink.kmeans.plusplus.iter10">
                    <constructor-arg name="name" value="kmeans.flink"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-test.static.points" />
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
            </list>
        </constructor-arg>
    </bean>

    <bean id="kmeans-test.minibatch-10" class="org.peelframework.core.beans.experiment.ExperimentSuite">
        <constructor-arg name="experiments">
            <list value-type="org.peelframework.core.beans.experiment.Experiment">
                <bean parent="experiment.flink.kmeans.minibatch.samplesize10">
                    <constructor-arg name="name" value="kmeans.flink"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-test.static.points" />
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
            </list>
        </constructor-arg>
    </bean>

    <bean id="kmeans-test.minibatch-20" class="org.peelframework.core.beans.experiment.ExperimentSuite">
        <constructor-arg name="experiments">
            <list value-type="org.peelframework.core.beans.experiment.Experiment">
                <bean parent="experiment.flink.kmeans.minibatch.samplesize20">
                    <constructor-arg name="name" value="kmeans.flink"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-test.static.points" />
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
            </list>
        </constructor-arg>
    </bean>

    <bean id="kmeans-test.bisecting-3" class="org.peelframework.core.beans.experiment.ExperimentSuite">
        <constructor-arg name="experiments">
            <list value-type="org.peelframework.core.beans.experiment.Experiment">
                <bean parent="experiment.flink.kmeans.bisecting.itersample3">
                    <constructor-arg name="name" value="kmeans.flink"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-test.static.points" />
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
            </list>
        </constructor-arg>
    </bean>

    <bean id="kmeans-test.bisecting-5" class="org.peelframework.core.beans.experiment.ExperimentSuite">
        <constructor-arg name="experiments">
            <list value-type="org.peelframework.core.beans.experiment.Experiment">
                <bean parent="experiment.flink.kmeans.bisecting.itersample5">
                    <constructor-arg name="name" value="kmeans.flink"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-test.static.points" />
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
            </list>
        </constructor-arg>
    </bean>

    <bean id="kmeans-test.bisecting-11" class="org.peelframework.core.beans.experiment.ExperimentSuite">
        <constructor-arg name="experiments">
            <list value-type="org.peelframework.core.beans.experiment.Experiment">
                <bean parent="experiment.flink.kmeans.bisecting.itersample11">
                    <constructor-arg name="name" value="kmeans.flink"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-test.static.points" />
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
            </list>
        </constructor-arg>
    </bean>

    <!--  Mini Batch K-Means VS K-Means++ -->
    <bean id="kmeans-test.set1" class="org.peelframework.core.beans.experiment.ExperimentSuite">
        <constructor-arg name="experiments">
            <list value-type="org.peelframework.core.beans.experiment.Experiment">
                <bean parent="experiment.flink.kmeans.plusplus.iter10">
                    <constructor-arg name="name" value="kmeans.minibatch"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-test.static.points" />
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
                <bean parent="experiment.flink.kmeans.minibatch.samplesize10">
                    <constructor-arg name="name" value="kmeans.plusplus"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-test.static.points" />
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
            </list>
        </constructor-arg>
    </bean>

    <bean id="kmeans-test.set2" class="org.peelframework.core.beans.experiment.ExperimentSuite">
        <constructor-arg name="experiments">
            <list value-type="org.peelframework.core.beans.experiment.Experiment">
                <bean parent="experiment.flink.kmeans.plusplus.iter10">
                    <constructor-arg name="name" value="kmeans.minibatch"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-test.static.points" />
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
                <bean parent="experiment.flink.kmeans.minibatch.samplesize20">
                    <constructor-arg name="name" value="kmeans.bisecting"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-test.static.points" />
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
            </list>
        </constructor-arg>
    </bean>

    <bean id="kmeans-test.set3" class="org.peelframework.core.beans.experiment.ExperimentSuite">
        <constructor-arg name="experiments">
            <list value-type="org.peelframework.core.beans.experiment.Experiment">
                <bean parent="experiment.flink.kmeans.plusplus.iter10">
                    <constructor-arg name="name" value="kmeans.plusplus"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-test.static.points" />
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
                <bean parent="experiment.flink.kmeans.bisecting.itersample3">
                    <constructor-arg name="name" value="kmeans.bisecting"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-test.static.points" />
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
            </list>
        </constructor-arg>
    </bean>

    <bean id="kmeans-test.set4" class="org.peelframework.core.beans.experiment.ExperimentSuite">
        <constructor-arg name="experiments">
            <list value-type="org.peelframework.core.beans.experiment.Experiment">
                <bean parent="experiment.flink.kmeans.plusplus.iter10">
                    <constructor-arg name="name" value="kmeans.plusplus"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-test.static.points" />
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
                <bean parent="experiment.flink.kmeans.bisecting.itersample5">
                    <constructor-arg name="name" value="kmeans.bisecting"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-test.static.points" />
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
            </list>
        </constructor-arg>
    </bean>

    <bean id="kmeans-test.set5" class="org.peelframework.core.beans.experiment.ExperimentSuite">
        <constructor-arg name="experiments">
            <list value-type="org.peelframework.core.beans.experiment.Experiment">
                <bean parent="experiment.flink.kmeans.plusplus.iter10">
                    <constructor-arg name="name" value="kmeans.plusplus"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-test.static.points" />
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
                <bean parent="experiment.flink.kmeans.bisecting.itersample11">
                    <constructor-arg name="name" value="kmeans.bisecting"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-test.static.points" />
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
            </list>
        </constructor-arg>
    </bean>

    <bean id="kmeans-test.set6" class="org.peelframework.core.beans.experiment.ExperimentSuite">
        <constructor-arg name="experiments">
            <list value-type="org.peelframework.core.beans.experiment.Experiment">
                <bean parent="experiment.flink.kmeans.plusplus.iter10">
                    <constructor-arg name="name" value="kmeans.plusplus"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-test.static.points" />
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
                <bean parent="experiment.flink.kmeans.minibatch.samplesize10">
                    <constructor-arg name="name" value="kmeans.bisecting"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-test.static.points" />
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
                <bean parent="experiment.flink.kmeans.bisecting.itersample5">
                    <constructor-arg name="name" value="kmeans.bisecting"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-test.static.points" />
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
            </list>
        </constructor-arg>
    </bean>

    <bean id="kmeans-test.set7" class="org.peelframework.core.beans.experiment.ExperimentSuite">
        <constructor-arg name="experiments">
            <list value-type="org.peelframework.core.beans.experiment.Experiment">
                <bean parent="experiment.flink.kmeans.plusplus.iter10">
                    <constructor-arg name="name" value="kmeans.plusplus"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-test.static.points" />
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
                <bean parent="experiment.flink.kmeans.minibatch.samplesize20">
                    <constructor-arg name="name" value="kmeans.bisecting"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-test.static.points" />
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
                <bean parent="experiment.flink.kmeans.bisecting.itersample5">
                    <constructor-arg name="name" value="kmeans.bisecting"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-test.static.points" />
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
            </list>
        </constructor-arg>
    </bean>

    <!-- suite for scale-out on 5, 10, and 20 nodes -->
    <bean id="kmeans.scale-out" class="org.peelframework.core.beans.experiment.ExperimentSuite">
        <constructor-arg name="experiments">
            <bean class="org.peelframework.core.beans.experiment.ExperimentSequence">
                <constructor-arg name="paramName" value="topXXX"/>
                <constructor-arg name="paramVals">
                    <list>
                        <value>top005</value>
                        <value>top010</value>
                        <value>top020</value>
                    </list>
                </constructor-arg>
                <constructor-arg name="prototypes">
                    <list value-type="org.peelframework.core.beans.experiment.Experiment">
                        <bean parent="experiment.flink.kmeans.plain.iter5">
                            <constructor-arg name="name" value="kmeans.flink.__topXXX__"/>
                            <constructor-arg name="inputs">
                                <set>
                                    <ref bean="dataset.kmeans-test.static.points" />
                                </set>
                            </constructor-arg>
                            <constructor-arg name="config">
                                <value><![CDATA[
                                  system.default.config.slaves            = ${env.slaves.__topXXX__.hosts}
                                  system.default.config.parallelism.total = ${env.slaves.__topXXX__.total.parallelism}
                                  datagen.dictionary.dize                 = 10000
                                  datagen.tuples.per.task                 = 10000000 # ~ 100 MB
                                  datagen.data-distribution               = Uniform
                                ]]></value>
                            </constructor-arg>
                        </bean>
                    </list>
                </constructor-arg>
            </bean>
        </constructor-arg>
    </bean>

</beans>