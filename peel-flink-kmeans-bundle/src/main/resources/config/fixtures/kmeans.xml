<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns="http://www.springframework.org/schema/beans"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <!--************************************************************************
    * Data Sets
    *************************************************************************-->

    <bean id="dataset.kmeans-10k.static.points" class="org.peelframework.core.beans.data.CopiedDataSet">
        <constructor-arg name="src" value="${app.path.datasets}/points-10k.csv"/>
        <constructor-arg name="dst" value="${system.hadoop-2.path.input}/points-10k.csv"/>
        <constructor-arg name="fs" ref="hdfs-2.7.1"/>
    </bean>

    <bean id="dataset.kmeans-10k.static.centroids" class="org.peelframework.core.beans.data.CopiedDataSet">
        <constructor-arg name="src" value="${app.path.datasets}/centroids-10k.csv"/>
        <constructor-arg name="dst" value="${system.hadoop-2.path.input}/centroids-10k.csv"/>
        <constructor-arg name="fs" ref="hdfs-2.7.1"/>
    </bean>

    <!--************************************************************************
    * Experiments
    *************************************************************************-->

    <!-- K-Means output -->
    <bean id="kmeans-10k.output" class="org.peelframework.core.beans.data.ExperimentOutput">
        <constructor-arg name="path" value="${system.hadoop-2.path.output}/kmeans-10k"/>
        <constructor-arg name="fs" ref="hdfs-2.7.1"/>
    </bean>

    <bean id="experiment.flink.kmeans.plain" parent="experiment.flink-1.0.3" abstract="true">
        <constructor-arg name="command">
            <value><![CDATA[
              -v -c de.tu_berlin.dima.bdapro.benchmarks.kmeans.flink.KMeans           \
              ${app.path.apps}/peel-flink-kmeans-flink-jobs-1.0-SNAPSHOT.jar          \
              --points ${system.hadoop-2.path.input}/points-10k.csv                   \
              --centroids ${system.hadoop-2.path.input}/centroids-10k.csv             \
              --output ${system.hadoop-2.path.output}/output-10k-plain.csv                  \
              --outputcentroids                                                       \
              --algorithm default
            ]]></value>
        </constructor-arg>
        <constructor-arg name="outputs">
            <set value-type="org.peelframework.core.beans.data.ExperimentOutput">
                <ref bean="kmeans-10k.output"/>
            </set>
        </constructor-arg>
    </bean>

    <bean id="experiment.flink.kmeans.minibatch" parent="experiment.flink-1.0.3" abstract="true">
        <constructor-arg name="command">
            <value><![CDATA[
              -v -c de.tu_berlin.dima.bdapro.benchmarks.kmeans.flink.KMeans           \
              ${app.path.apps}/peel-flink-kmeans-flink-jobs-1.0-SNAPSHOT.jar          \
              --points ${system.hadoop-2.path.input}/points-10k.csv                   \
              --centroids ${system.hadoop-2.path.input}/centroids-10k.csv             \
              --output ${system.hadoop-2.path.output}/output-10k-minibatch.csv        \
              --outputcentroids                                                       \
              --algorithm minibatch                                                   \
              --samplesize 10                                                         \
              --iterations 10
            ]]></value>
        </constructor-arg>
        <constructor-arg name="outputs">
            <set value-type="org.peelframework.core.beans.data.ExperimentOutput">
                <ref bean="kmeans-10k.output"/>
            </set>
        </constructor-arg>
    </bean>

    <bean id="experiment.flink.kmeans.plusplus" parent="experiment.flink-1.0.3" abstract="true">
        <constructor-arg name="command">
            <value><![CDATA[
              -v -c de.tu_berlin.dima.bdapro.benchmarks.kmeans.flink.KMeans           \
              ${app.path.apps}/peel-flink-kmeans-flink-jobs-1.0-SNAPSHOT.jar          \
              --points ${system.hadoop-2.path.input}/points-10k.csv                   \
              --centroids ${system.hadoop-2.path.input}/centroids-10k.csv             \
              --output ${system.hadoop-2.path.output}/output-10k-plusplus.csv         \
              --outputcentroids                                                       \
              --algorithm plusplus                                                    \
              --clustersize 4
            ]]></value>
        </constructor-arg>
        <constructor-arg name="outputs">
            <set value-type="org.peelframework.core.beans.data.ExperimentOutput">
                <ref bean="kmeans-10k.output"/>
            </set>
        </constructor-arg>
    </bean>

    <bean id="experiment.flink.kmeans.bisecting" parent="experiment.flink-1.0.3" abstract="true">
        <constructor-arg name="command">
            <value><![CDATA[
              -v -c de.tu_berlin.dima.bdapro.benchmarks.kmeans.flink.KMeans           \
              ${app.path.apps}/peel-flink-kmeans-flink-jobs-1.0-SNAPSHOT.jar          \
              --points ${system.hadoop-2.path.input}/points-10k.csv                   \
              --centroids ${system.hadoop-2.path.input}/centroids-10k.csv             \
              --output ${system.hadoop-2.path.output}/output-10k-bisecting.csv        \
              --outputcentroids                                                       \
              --algorithm bisecting
            ]]></value>
        </constructor-arg>
        <constructor-arg name="outputs">
            <set value-type="org.peelframework.core.beans.data.ExperimentOutput">
                <ref bean="kmeans-10k.output"/>
            </set>
        </constructor-arg>
    </bean>

    <!--************************************************************************
    * Suites
    *************************************************************************-->

    <!-- suite for local development and testing -->
    <bean id="kmeans.plain" class="org.peelframework.core.beans.experiment.ExperimentSuite">
        <constructor-arg name="experiments">
            <list value-type="org.peelframework.core.beans.experiment.Experiment">
                <bean parent="experiment.flink.kmeans.plain">
                    <constructor-arg name="name" value="kmeans.flink"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-10k.static.centroids"/>
                            <ref bean="dataset.kmeans-10k.static.points"/>
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
            </list>
        </constructor-arg>
    </bean>

    <bean id="kmeans.minibatch" class="org.peelframework.core.beans.experiment.ExperimentSuite">
        <constructor-arg name="experiments">
            <list value-type="org.peelframework.core.beans.experiment.Experiment">
                <bean parent="experiment.flink.kmeans.minibatch">
                    <constructor-arg name="name" value="kmeans.flink"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-10k.static.centroids"/>
                            <ref bean="dataset.kmeans-10k.static.points"/>
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
            </list>
        </constructor-arg>
    </bean>

    <bean id="kmeans.plusplus" class="org.peelframework.core.beans.experiment.ExperimentSuite">
        <constructor-arg name="experiments">
            <list value-type="org.peelframework.core.beans.experiment.Experiment">
                <bean parent="experiment.flink.kmeans.plusplus">
                    <constructor-arg name="name" value="kmeans.flink"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-10k.static.centroids"/>
                            <ref bean="dataset.kmeans-10k.static.points"/>
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
            </list>
        </constructor-arg>
    </bean>

    <bean id="kmeans.bisecting" class="org.peelframework.core.beans.experiment.ExperimentSuite">
        <constructor-arg name="experiments">
            <list value-type="org.peelframework.core.beans.experiment.Experiment">
                <bean parent="experiment.flink.kmeans.bisecting">
                    <constructor-arg name="name" value="kmeans.flink"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-10k.static.centroids"/>
                            <ref bean="dataset.kmeans-10k.static.points"/>
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
            </list>
        </constructor-arg>
    </bean>

    <!--  Mini Batch K-Means VS K-Means++ -->
    <bean id="kmeans.set1" class="org.peelframework.core.beans.experiment.ExperimentSuite">
        <constructor-arg name="experiments">
            <list value-type="org.peelframework.core.beans.experiment.Experiment">
                <bean parent="experiment.flink.kmeans.minibatch">
                    <constructor-arg name="name" value="kmeans.minibatch"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-10k.static.centroids"/>
                            <ref bean="dataset.kmeans-10k.static.points"/>
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
                <bean parent="experiment.flink.kmeans.plusplus">
                    <constructor-arg name="name" value="kmeans.plusplus"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-10k.static.centroids"/>
                            <ref bean="dataset.kmeans-10k.static.points"/>
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
            </list>
        </constructor-arg>
    </bean>

    <!-- Mini Batch K-Means VS Bisecting K-Means -->
    <bean id="kmeans.set2" class="org.peelframework.core.beans.experiment.ExperimentSuite">
        <constructor-arg name="experiments">
            <list value-type="org.peelframework.core.beans.experiment.Experiment">
                <bean parent="experiment.flink.kmeans.minibatch">
                    <constructor-arg name="name" value="kmeans.minibatch"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-10k.static.centroids"/>
                            <ref bean="dataset.kmeans-10k.static.points"/>
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
                <bean parent="experiment.flink.kmeans.bisecting">
                    <constructor-arg name="name" value="kmeans.bisecting"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-10k.static.centroids"/>
                            <ref bean="dataset.kmeans-10k.static.points"/>
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
            </list>
        </constructor-arg>
    </bean>

    <!-- K-Means++ VS Bisecting K-Means -->
    <bean id="kmeans.set3" class="org.peelframework.core.beans.experiment.ExperimentSuite">
        <constructor-arg name="experiments">
            <list value-type="org.peelframework.core.beans.experiment.Experiment">
                <bean parent="experiment.flink.kmeans.plusplus">
                    <constructor-arg name="name" value="kmeans.plusplus"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-10k.static.centroids"/>
                            <ref bean="dataset.kmeans-10k.static.points"/>
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
                <bean parent="experiment.flink.kmeans.bisecting">
                    <constructor-arg name="name" value="kmeans.bisecting"/>
                    <constructor-arg name="inputs">
                        <set>
                            <ref bean="dataset.kmeans-10k.static.centroids"/>
                            <ref bean="dataset.kmeans-10k.static.points"/>
                        </set>
                    </constructor-arg>
                    <constructor-arg name="config" value=""/>
                </bean>
            </list>
        </constructor-arg>
    </bean>

    <!-- suite for scale-out on 5, 10, and 20 nodes -->
    <bean id="kmeans.scale-out" class="org.peelframework.core.beans.experiment.ExperimentSuite">
        <constructor-arg name="experiments">
            <bean class="org.peelframework.core.beans.experiment.ExperimentSequence">
                <constructor-arg name="paramName" value="topXXX"/>
                <constructor-arg name="paramVals">
                    <list>
                        <value>top005</value>
                        <value>top010</value>
                        <value>top020</value>
                    </list>
                </constructor-arg>
                <constructor-arg name="prototypes">
                    <list value-type="org.peelframework.core.beans.experiment.Experiment">
                        <bean parent="experiment.flink.kmeans.plain">
                            <constructor-arg name="name" value="kmeans.flink.__topXXX__"/>
                            <constructor-arg name="inputs">
                                <set>
                                    <ref bean="dataset.kmeans-10k.static.centroids"/>
                                    <ref bean="dataset.kmeans-10k.static.points"/>
                                </set>
                            </constructor-arg>
                            <constructor-arg name="config">
                                <value><![CDATA[
                                  system.default.config.slaves            = ${env.slaves.__topXXX__.hosts}
                                  system.default.config.parallelism.total = ${env.slaves.__topXXX__.total.parallelism}
                                  datagen.dictionary.dize                 = 10000
                                  datagen.tuples.per.task                 = 10000000 # ~ 100 MB
                                  datagen.data-distribution               = Uniform
                                ]]></value>
                            </constructor-arg>
                        </bean>
                    </list>
                </constructor-arg>
            </bean>
        </constructor-arg>
    </bean>

</beans>